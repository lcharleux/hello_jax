<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Introduction - JAX pour Cloé</title><meta property="og:title" content="Introduction - JAX pour Cloé"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><meta name="image" content="/hello_jax/build/96a8e99706627d5058e08d07f71549be.webp"/><meta property="og:image" content="/hello_jax/build/96a8e99706627d5058e08d07f71549be.webp"/><link rel="stylesheet" href="/hello_jax/build/_assets/app-KKSZXL3E.css"/><link rel="stylesheet" href="/hello_jax/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/hello_jax/favicon.ico"/><link rel="stylesheet" href="/hello_jax/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/hello_jax/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="JAX pour Cloé" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/hello_jax/">JAX pour Cloé</a><a title="Des ODE avec Jax ?" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/hello_jax/ode-with-jax">Des ODE avec Jax ?</a></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/lcharleux/hello_jax" title="GitHub Repository: lcharleux/hello_jax" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/lcharleux/hello_jax/edit/main/book/00_intro_to_jax.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Introduction</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="rsfPFQwqdy" class="myst-jp-nb-block relative group/block"><h2 id="la-promesse-de-jax" class="relative group"><span class="heading-text">La promesse de Jax</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#la-promesse-de-jax" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="h8hbbnq0vi" class="myst-jp-nb-block relative group/block"><p>Jax promet de pouvoir écrire du code Python et de le déployer sur des plateformes CPU, GPU et TPU-Google sans efforts de traduction particuliers. Il permet aussi de faire des opérations (transformations) assez inédites comme la dérivation automatique des fonctions par rapport à leurs arguments ce qui constitue en soit un game changer pour l’IA et bien d’autres domaines.</p></div><div id="LI9EOLBp9n" class="myst-jp-nb-block relative group/block"><h2 id="le-monde-de-jax" class="relative group"><span class="heading-text">Le monde de Jax</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#le-monde-de-jax" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Avec des pincettes énormes, on pourrait résumer le monde de Jax à des données sous forme de <strong>tenseurs</strong> qui sont manipulées par des <strong>fonctions pures</strong> auxquelles on applique des <strong>transformations</strong>.
Dans les nuances à apporter, il faut noter les données tensorielle sont agencées sous forme de <em><strong>pytrees</strong></em> ce qui une idées extrêmement puissante à elle seule, même si ce n’est pas ce qui saute aux yeux quand on début Jax.</p></div><div id="IqBXJOkGdl" class="myst-jp-nb-block relative group/block"><h2 id="des-fonctions-pures" class="relative group"><span class="heading-text">Des fonctions pures ?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#des-fonctions-pures" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Dans Jax, la pureté des fonctions est un sujet qui revient souvent. Une fonction pure est une fonction qui n’a pas d’effets de bords.
Elle n’utilise donc pas l’infinité de bidouilles que Python autorise.
Dans les grandes lignes, les sorties d’une fonction doivent dépendre de manière déterministe de ses arguments et uniquement d’eux.
Cela interdit notamment l’usage de variables globales (enfin, on verra que c’est plus subtile) et aussi de modifier dynamiquement ses propres arguments comme on le ferait souvent en <em>C</em>.
Si on pense <em>C</em> justement, on peut se dire cette approche est antinomique avec l’économie de mémoire et la performance en général, en fait oui et non.
Jax impose cette contrainte car il va voir les fonctions comme des scripts à interpréter dans son langage (voir <strong>jaxpr</strong>) et à traduire dans un langage dédié à la plateforme cible.
L’optimisation au sens ou la verrait en C n’a donc pas lieu d’être.
Le but de la pureté est avant tout de lever toute ambiguïté sur le fonctionnement interne de la fonction et de pouvoir y tracer le chemin de l’information.
Il faut donc voir les fonctions comme des tuyaux dans lesquels le flux de données passe et la pureté indique juste que ces derniers ne doivent pas fuir ni laisser entrer des choses du milieu extérieur.</p><p>Voici un petit exemple de fonction pure et de la manière sont Jax la comprend:</p></div><div id="OjoppGeLq2" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import jax
from jax import numpy as jnp
import time


def dumb_pure_func(x):
    b = x + 3
    c = b**2
    return c


dumb_pure_func(3)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="vUJpJJaTiCHOBLqPCHjjo" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>36</span></code></div></div></div><div id="FliC6c7QsJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">jax.make_jaxpr(dumb_pure_func)(2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="9xZDGRJhqkNz5mX-10VtL" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>{ </span><span style="color:rgb(0, 0, 187);font-weight:bold">lambda </span><span>; a</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span>. </span><span style="color:rgb(0, 0, 187);font-weight:bold">let
    </span><span>b</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> = add a 3:i32[]
    c</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> = integer_pow[y=2] b
  </span><span style="color:rgb(0, 0, 187);font-weight:bold">in </span><span>(c,) }</span></code></div></div></div><div id="yeUhyWSAQi" class="myst-jp-nb-block relative group/block"><p>Jax est donc capable de comprendre le fonctionnement de la fonction est de la traduire par un bout de code dans son langage.</p></div><div id="JRtheriEmX" class="myst-jp-nb-block relative group/block"><h2 id="les-transformations" class="relative group"><span class="heading-text">Les transformations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#les-transformations" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Imaginons qu’on travaille sur la fonction suivante:</p></div><div id="vzhUx22ZHr" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def myfunc(x, a=1, b=1, c=1):
    return a * x**2 + b * x + c


jax.make_jaxpr(myfunc)(3, 1, 1, 1)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="8f36UO8SW064fyqRmSn21" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>{ </span><span style="color:rgb(0, 0, 187);font-weight:bold">lambda </span><span>; a</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> b</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> c</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> d</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span>. </span><span style="color:rgb(0, 0, 187);font-weight:bold">let
    </span><span>e</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> = integer_pow[y=2] a
    f</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> = mul b e
    g</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> = mul c a
    h</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> = add f g
    i</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> = add h d
  </span><span style="color:rgb(0, 0, 187);font-weight:bold">in </span><span>(i,) }</span></code></div></div></div><div id="Cj5LIx4ZAe" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">myfunc(5)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="oEL6k8nkn5Yafhdu1bi-n" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>31</span></code></div></div></div><div id="mkHaSl6FPU" class="myst-jp-nb-block relative group/block"><h3 id="vectoriser-avec-vmap" class="relative group"><span class="heading-text">Vectoriser avec <code>vmap</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#vectoriser-avec-vmap" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>On peut vectoriser par rapport à un axe par exemple avec vmap.</p></div><div id="rk3dYQtnBF" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">vmyfunc = jax.vmap(myfunc, in_axes=(0, None, None, None))
xa = jnp.linspace(0.0, 5.0, 6)
vmyfunc(xa, 1, 1, 1)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="h5gRGA0h-obLgRZmrWhIu" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>Array([ 1.,  3.,  7., 13., 21., 31.], dtype=float32)</span></code></div></div></div><div id="IiUNgR8V3Q" class="myst-jp-nb-block relative group/block"><p>Mais on peut faire des structure bien plus complexes en combinant plusieurs transformations:</p></div><div id="DXYxuszJTt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">vmyfunc2 = jax.vmap(vmyfunc, in_axes=(None, 0, None, None))
aa = jnp.linspace(0.0, 1.0, 3)
vmyfunc2(xa, aa, 1, 1)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="6mQf6k50abIMXTg6vYM-y" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>Array([[ 1. ,  2. ,  3. ,  4. ,  5. ,  6. ],
       [ 1. ,  2.5,  5. ,  8.5, 13. , 18.5],
       [ 1. ,  3. ,  7. , 13. , 21. , 31. ]], dtype=float32)</span></code></div></div></div><div id="oWKgzFUK2i" class="myst-jp-nb-block relative group/block"><p>Le potentiel est énorme car on peut soit vectoriser en plusieurs strates ou aussi le faire d’un coup en jouant sur les axes selon les besoins.</p></div><div id="KYmSKL0DvL" class="myst-jp-nb-block relative group/block"><h3 id="compiler-avec-jit" class="relative group"><span class="heading-text">Compiler avec <code>jit</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#compiler-avec-jit" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Il est possible de compiler tout ou partie du code avec <code>jit</code>. La compilation va coûter quelques milisecondes et permettre une execution optimisée par la suite.</p></div><div id="zAxImc1AaT" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">Ne = 100
xa = jnp.linspace(0.0, 5.0, 6000)
aa = jnp.linspace(0.0, 1.0, 3000)
t0 = time.time()
for e in range(Ne):
    val = vmyfunc2(xa, aa, 1, 1)
    val.block_until_ready()
t1 = time.time()
dt0 = (t1 - t0) / Ne
print(f&quot;Exectution took {dt0*1.e3:.2f} ms&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="eMuoJiTBj-R8f_wCfcC4b" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Exectution took 6.99 ms
</span></code></pre></div></div></div><div id="aAhSzFGn2x" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">jvmyfunc2 = jax.jit(vmyfunc2)
t0 = time.time()
val = jvmyfunc2(xa, aa, 1, 1)
val.block_until_ready()
t1 = time.time()
dt1 = t1 - t0
print(f&quot;Compilation + first execution took {dt1*1.e3:.2f} ms&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="kH8RBW-gCcZmePPSDA3w1" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Compilation + first execution took 19.40 ms
</span></code></pre></div></div></div><div id="qxrwyouxg9" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">t0 = time.time()
for e in range(Ne):
    val = jvmyfunc2(xa, aa, 1, 1)
    val.block_until_ready()
t1 = time.time()
dt2 = (t1 - t0) / Ne
print(f&quot;Second execution took {dt2*1.e3:.2f} ms&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="gEW-V2B07QIu0liKpi5ak" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Second execution took 1.83 ms
</span></code></pre></div></div></div><div id="gp82DFVutR" class="myst-jp-nb-block relative group/block"><p>On a donc gagné du temps avec le jit et ce malgré le fait que notre fonction est très simple et donc très optimisée à la base. Cette tendance sera amplifiée sur des calculs lourds sur GPU/TPU.</p></div><div id="iIQu3Gtemn" class="myst-jp-nb-block relative group/block"><h3 id="autres-transformations" class="relative group"><span class="heading-text">Autres transformations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#autres-transformations" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Les autres transformations ne sont pas cruciales maintenant alors je les passe sous couvert. Mais elles sont ultra intéressantes dans d’autres cas, surtout <code>grad</code>.</p></div><div id="APF6c3EvIA" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># WIP</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="0BG31QpPuCNcwaf2UIORJ" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="YF4GTmYd58" class="myst-jp-nb-block relative group/block"><h2 id="liste-non-exhaustive-des-limitations-de-jax" class="relative group"><span class="heading-text">Liste non exhaustive des limitations de Jax</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#liste-non-exhaustive-des-limitations-de-jax" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Forcément, cette belle promesse vient avec pas mal de limitations.</p><h3 id="les-structures-de-contr-le" class="relative group"><span class="heading-text">Les structures de contrôle</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#les-structures-de-contr-le" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>On commence par une des plus agacentes au début, les structures de contrôle. Fini les <code>if</code>, <code>for</code>et <code>while</code>.</p><picture class=""><source srcSet="/hello_jax/build/96a8e99706627d5058e08d07f71549be.webp" type="image/webp"/><img id="MuAeWh2E0v" style="margin:0 auto" src="/hello_jax/build/96a8e99706627d5058e08d07f71549be.gif" data-canonical-url="https://media1.tenor.com/m/-mkYatTHWB0AAAAC/why-whyy.gif"/></picture><p>En fait, ces dernières ne sont pas claires dans leurs buts et peuvent correspondre à plusieurs objectifs. Jax fournit donc des outils de remplacements qui ne manqueront pas de vous énerver (parfois). A titre d’exemple, <code>for</code>sera remplacée alternativement selon les buts par <code>vmap</code>, <code>scan</code>, <code>where</code>, <code>lax.fori_loop</code> ou pourra rester <code>for</code> dans ces bien choisis.</p></div><div id="nW0OhjOOpr" class="myst-jp-nb-block relative group/block"><h3 id="lallocation-dynamique-de-m-moire" class="relative group"><span class="heading-text">L’allocation dynamique de mémoire</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#lallocation-dynamique-de-m-moire" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Dans le monde de jax, il est interdit d’allouer dynamiquement de la mémoire, par exemple en créant des array de taille inconnue à la compilation. Cela ne manquera pas de vous créer des frustrations. On verra aussi qu’il est possible de trouver des compromis sur ce point. Le chapitre des <em>sharp bits</em> et globalement toutes les prises de parole de JakeVPD et Patrick Kidger mérite d’être lues pour comprendre la parole sainte à ce sujet.</p><p>Exemple:</p></div><div id="vsLrQmvYWV" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def dumb_func_allocating_memory(n):
    a = jnp.arange(n)
    return a</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="BE9q7dl8QKSc1zsGS4DoN" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="LmYYB8fQFC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># jax.make_jaxpr(dumb_func_allocating_memory)(2) # Uncommment to see the error.</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="8lOUAgyN0E3AWtuZOs9In" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="lo0Dyj31LT" class="myst-jp-nb-block relative group/block"><hr class="py-2 my-5 translate-y-2"/><p>ConcretizationTypeError                   Traceback (most recent call last)
Cell In[11], line 1
----&gt; 1 jax.make_jaxpr(dumb_func_allocating_memory)(2)</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">[... skipping hidden 14 frame]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Cell In[10], line 2, in dumb_func_allocating_memory(n)
1 def dumb_func_allocating_memory(n):
----&gt; 2     a = jnp.arange(n)
3     return a</p><p>File ~/miniforge3/envs/science/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:5947, in arange(start, stop, step, dtype, device, out_sharding)
5945 if sharding is None or not sharding._is_concrete:
5946   assert sharding is None or isinstance(sharding, NamedSharding)
-&gt; 5947   return _arange(start, stop=stop, step=step, dtype=dtype,
5948                  out_sharding=sharding)
5949 else:
5950   output = _arange(start, stop=stop, step=step, dtype=dtype)</p><p>File ~/miniforge3/envs/science/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:5962, in _arange(start, stop, step, dtype, out_sharding)
5960 util.check_arraylike(“arange”, start)
5961 if stop is None and step is None:
-&gt; 5962   start = core.concrete_or_error(None, start, “It arose in the jnp.arange argument ‘stop’”)
5963 else:
5964   start = core.concrete_or_error(None, start, “It arose in the jnp.arange argument ‘start’”)</p><p>File ~/miniforge3/envs/science/lib/python3.12/site-packages/jax/_src/core.py:1847, in concrete_or_error(force, val, context)
1845 maybe_concrete = val.to_concrete_value()
1846 if maybe_concrete is None:
-&gt; 1847   raise ConcretizationTypeError(val, context)
1848 else:
1849   return force(maybe_concrete)</p><p>ConcretizationTypeError: Abstract tracer value encountered where concrete value is expected: traced array with shape int32[]
It arose in the jnp.arange argument ‘stop’
The error occurred while tracing the function dumb_func_allocating_memory at /var/folders/67/hblp6z8n36ldk_9_bl9g80kh0000gn/T/ipykernel_50677/3347747001.py:1 for jit. This concrete value was not available in Python because it depends on the value of the argument n.</p><p>See <a target="_blank" rel="noreferrer" href="https://docs.jax.dev/en/latest/errors.html#jax.errors.ConcretizationTypeError" class="">https://<wbr/>docs<wbr/>.jax<wbr/>.dev<wbr/>/en<wbr/>/latest<wbr/>/errors<wbr/>.html<wbr/>#jax<wbr/>.errors<wbr/>.ConcretizationTypeError</a></p></div><div id="F8brUWEun1" class="myst-jp-nb-block relative group/block"><p>Frustration, colère ...</p></div><div id="Vu6RBAoJtY" class="myst-jp-nb-block relative group/block"><p>Dans un tel, cas il faut généralement se demander si on a vraiment besoin que <code>n</code>soit dynamique. Si c’est vraiment le cas, alors on peut le rendre statique (au sens jax) en spécifiant:</p></div><div id="hB3NahzOwk" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import numpy as np


def make_dumb_function_allocating_memory(n):
    def dumb_func_allocating_memory2(a):
        x = a * jnp.arange(n)
        return x

    return dumb_func_allocating_memory2


dfam = jax.jit(make_dumb_function_allocating_memory(3))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="SSA1J3HsAQGepVRgkfLc2" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="F9mHfOsvYd" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">jax.make_jaxpr(dfam)(2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="5uwi0WoXGzyjm0IhRzQkQ" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>{ </span><span style="color:rgb(0, 0, 187);font-weight:bold">lambda </span><span>; a</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span>. </span><span style="color:rgb(0, 0, 187);font-weight:bold">let
    </span><span>b</span><span style="color:rgb(187, 0, 187)">:i32[3]</span><span> = jit[
      name=dumb_func_allocating_memory2
      jaxpr={ </span><span style="color:rgb(0, 0, 187);font-weight:bold">lambda </span><span>; a</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span>. </span><span style="color:rgb(0, 0, 187);font-weight:bold">let
          </span><span>c</span><span style="color:rgb(187, 0, 187)">:i32[3]</span><span> = iota[dimension=0 dtype=int32 shape=(3,) sharding=None] 
          d</span><span style="color:rgb(187, 0, 187)">:i32[]</span><span> = convert_element_type[new_dtype=int32 weak_type=False] a
          b</span><span style="color:rgb(187, 0, 187)">:i32[3]</span><span> = mul d c
        </span><span style="color:rgb(0, 0, 187);font-weight:bold">in </span><span>(b,) }
    ] a
  </span><span style="color:rgb(0, 0, 187);font-weight:bold">in </span><span>(b,) }</span></code></div></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/hello_jax/ode-with-jax"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">JAX pour Cloé</div>Des ODE avec Jax ?</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let d=Math.random().toString(32).slice(2);window.history.replaceState({key:d},"")}try{let u=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof u=="number"&&window.scrollTo(0,u)}catch(d){console.error(d),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/hello_jax/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-UGO2RSJF.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-HHKX4TLX.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-YATQFWLS.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-MBMQ6BQC.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-CVDX4WR7.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-NK7RXO5Q.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/hello_jax/build/root-TRTRBUUN.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-6NUWI4AQ.js"/><link rel="modulepreload" href="/hello_jax/build/_shared/chunk-M5KN76GI.js"/><link rel="modulepreload" href="/hello_jax/build/routes/$-VLPGWU3Z.js"/><script>window.__remixContext = {"url":"/intro-to-jax","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.4","options":{},"nav":[],"actions":[],"projects":[{"title":"JAX pour Cloé","github":"https://github.com/lcharleux/hello_jax","id":"8d100ed7-36b2-4354-97ab-43bab996214f","thumbnail":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.gif","thumbnailOptimized":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.webp","exports":[],"bibliography":[],"index":"intro-to-jax","pages":[{"slug":"ode-with-jax","title":"Des ODE avec Jax ?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/hello_jax"},"routes/$":{"config":{"version":2,"myst":"1.6.4","options":{},"nav":[],"actions":[],"projects":[{"title":"JAX pour Cloé","github":"https://github.com/lcharleux/hello_jax","id":"8d100ed7-36b2-4354-97ab-43bab996214f","thumbnail":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.gif","thumbnailOptimized":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.webp","exports":[],"bibliography":[],"index":"intro-to-jax","pages":[{"slug":"ode-with-jax","title":"Des ODE avec Jax ?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}]},"page":{"version":2,"kind":"Notebook","sha256":"88cfa48fad809e14db96f75b94282688b2c73e8050d8bbd0c63f02ed882dd5ee","slug":"intro-to-jax","location":"/00_intro_to_jax.ipynb","dependencies":[],"frontmatter":{"title":"Introduction","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"science","language":"python"},"github":"https://github.com/lcharleux/hello_jax","source_url":"https://github.com/lcharleux/hello_jax/blob/main/book/00_intro_to_jax.ipynb","edit_url":"https://github.com/lcharleux/hello_jax/edit/main/book/00_intro_to_jax.ipynb","thumbnail":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.gif","thumbnailOptimized":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.webp","exports":[{"format":"ipynb","filename":"00_intro_to_jax.ipynb","url":"/hello_jax/build/00_intro_to_jax-7b9df3052d5bf17c49c626236fd2f637.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"La promesse de Jax","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PRhnlxmhmX"}],"identifier":"la-promesse-de-jax","label":"La promesse de Jax","html_id":"la-promesse-de-jax","implicit":true,"key":"g0GjrYMjld"}],"key":"rsfPFQwqdy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Jax promet de pouvoir écrire du code Python et de le déployer sur des plateformes CPU, GPU et TPU-Google sans efforts de traduction particuliers. Il permet aussi de faire des opérations (transformations) assez inédites comme la dérivation automatique des fonctions par rapport à leurs arguments ce qui constitue en soit un game changer pour l’IA et bien d’autres domaines.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OlN9DX6q0C"}],"key":"znFK0iNMHA"}],"key":"h8hbbnq0vi"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Le monde de Jax","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H7mjX7QyDe"}],"identifier":"le-monde-de-jax","label":"Le monde de Jax","html_id":"le-monde-de-jax","implicit":true,"key":"MuQi8JJGmx"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Avec des pincettes énormes, on pourrait résumer le monde de Jax à des données sous forme de ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qdkaCTxElN"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tenseurs","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AaX03oQBEm"}],"key":"F1uOeOGSTU"},{"type":"text","value":" qui sont manipulées par des ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Hwb8whnfCX"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"fonctions pures","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VLKQbSsMyk"}],"key":"uiSSJsbUtD"},{"type":"text","value":" auxquelles on applique des ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"llX2OXy1xp"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"transformations","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wsCA8nr672"}],"key":"SauaEObwQE"},{"type":"text","value":".\nDans les nuances à apporter, il faut noter les données tensorielle sont agencées sous forme de ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xzTPxwJxBA"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"pytrees","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"osjny2FQmH"}],"key":"KkgdfgdiGi"}],"key":"hsBBY12Jdn"},{"type":"text","value":" ce qui une idées extrêmement puissante à elle seule, même si ce n’est pas ce qui saute aux yeux quand on début Jax.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EM8BVDhglE"}],"key":"jmNOitrJLy"}],"key":"LI9EOLBp9n"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Des fonctions pures ?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"p1yUFRPluJ"}],"identifier":"des-fonctions-pures","label":"Des fonctions pures ?","html_id":"des-fonctions-pures","implicit":true,"key":"MI0SS0nRmV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Dans Jax, la pureté des fonctions est un sujet qui revient souvent. Une fonction pure est une fonction qui n’a pas d’effets de bords.\nElle n’utilise donc pas l’infinité de bidouilles que Python autorise.\nDans les grandes lignes, les sorties d’une fonction doivent dépendre de manière déterministe de ses arguments et uniquement d’eux.\nCela interdit notamment l’usage de variables globales (enfin, on verra que c’est plus subtile) et aussi de modifier dynamiquement ses propres arguments comme on le ferait souvent en ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fqR9fvch3N"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"C","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ELDe2oQYwE"}],"key":"ugMTWidxQP"},{"type":"text","value":".\nSi on pense ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Zl5nBu455v"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"C","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hPp3hcMxdv"}],"key":"pVNDga5wHx"},{"type":"text","value":" justement, on peut se dire cette approche est antinomique avec l’économie de mémoire et la performance en général, en fait oui et non.\nJax impose cette contrainte car il va voir les fonctions comme des scripts à interpréter dans son langage (voir ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JeHhiVkAW6"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"jaxpr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pTF9346iYC"}],"key":"S7UDbIORA2"},{"type":"text","value":") et à traduire dans un langage dédié à la plateforme cible.\nL’optimisation au sens ou la verrait en C n’a donc pas lieu d’être.\nLe but de la pureté est avant tout de lever toute ambiguïté sur le fonctionnement interne de la fonction et de pouvoir y tracer le chemin de l’information.\nIl faut donc voir les fonctions comme des tuyaux dans lesquels le flux de données passe et la pureté indique juste que ces derniers ne doivent pas fuir ni laisser entrer des choses du milieu extérieur.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x3H8K0tqN5"}],"key":"gMWuIBCKwX"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Voici un petit exemple de fonction pure et de la manière sont Jax la comprend:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"mRlSq0cqMs"}],"key":"Dh7n7TJb4S"}],"key":"IqBXJOkGdl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import jax\nfrom jax import numpy as jnp\nimport time\n\n\ndef dumb_pure_func(x):\n    b = x + 3\n    c = b**2\n    return c\n\n\ndumb_pure_func(3)","key":"ycyKyx37x6"},{"type":"output","id":"vUJpJJaTiCHOBLqPCHjjo","data":[{"output_type":"execute_result","execution_count":1,"metadata":{},"data":{"text/plain":{"content":"36","content_type":"text/plain"}}}],"key":"SiwYNOO0np"}],"key":"OjoppGeLq2"},{"type":"block","kind":"notebook-code","data":{"lines_to_next_cell":2},"children":[{"type":"code","lang":"python","executable":true,"value":"jax.make_jaxpr(dumb_pure_func)(2)","key":"Tuu5nJVbhE"},{"type":"output","id":"9xZDGRJhqkNz5mX-10VtL","data":[{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"{ \u001b[34;1mlambda \u001b[39;22m; a\u001b[35m:i32[]\u001b[39m. \u001b[34;1mlet\n    \u001b[39;22mb\u001b[35m:i32[]\u001b[39m = add a 3:i32[]\n    c\u001b[35m:i32[]\u001b[39m = integer_pow[y=2] b\n  \u001b[34;1min \u001b[39;22m(c,) }","content_type":"text/plain"}}}],"key":"G0CaaSxdkt"}],"key":"FliC6c7QsJ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Jax est donc capable de comprendre le fonctionnement de la fonction est de la traduire par un bout de code dans son langage.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"R3wENOX0lI"}],"key":"cihme77yxM"}],"key":"yeUhyWSAQi"},{"type":"block","kind":"notebook-content","data":{"lines_to_next_cell":2},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Les transformations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K5wq0W1nYe"}],"identifier":"les-transformations","label":"Les transformations","html_id":"les-transformations","implicit":true,"key":"rGHGqP94U6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Imaginons qu’on travaille sur la fonction suivante:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SrsWrC9WyN"}],"key":"BxBVlfXbb3"}],"key":"JRtheriEmX"},{"type":"block","kind":"notebook-code","data":{"lines_to_next_cell":2},"children":[{"type":"code","lang":"python","executable":true,"value":"def myfunc(x, a=1, b=1, c=1):\n    return a * x**2 + b * x + c\n\n\njax.make_jaxpr(myfunc)(3, 1, 1, 1)","key":"nJAXNikwkO"},{"type":"output","id":"8f36UO8SW064fyqRmSn21","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"{ \u001b[34;1mlambda \u001b[39;22m; a\u001b[35m:i32[]\u001b[39m b\u001b[35m:i32[]\u001b[39m c\u001b[35m:i32[]\u001b[39m d\u001b[35m:i32[]\u001b[39m. \u001b[34;1mlet\n    \u001b[39;22me\u001b[35m:i32[]\u001b[39m = integer_pow[y=2] a\n    f\u001b[35m:i32[]\u001b[39m = mul b e\n    g\u001b[35m:i32[]\u001b[39m = mul c a\n    h\u001b[35m:i32[]\u001b[39m = add f g\n    i\u001b[35m:i32[]\u001b[39m = add h d\n  \u001b[34;1min \u001b[39;22m(i,) }","content_type":"text/plain"}}}],"key":"Aio7nncjUD"}],"key":"vzhUx22ZHr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"myfunc(5)","key":"grnepvgzDB"},{"type":"output","id":"oEL6k8nkn5Yafhdu1bi-n","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"31","content_type":"text/plain"}}}],"key":"j27veweyFz"}],"key":"Cj5LIx4ZAe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Vectoriser avec ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JItJPxNrOv"},{"type":"inlineCode","value":"vmap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MAEBJXp6F7"}],"identifier":"vectoriser-avec-vmap","label":"Vectoriser avec vmap","html_id":"vectoriser-avec-vmap","implicit":true,"key":"YEbyXqdS2f"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"On peut vectoriser par rapport à un axe par exemple avec vmap.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R8AvB5N86N"}],"key":"FkxKS5goov"}],"key":"mkHaSl6FPU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"vmyfunc = jax.vmap(myfunc, in_axes=(0, None, None, None))\nxa = jnp.linspace(0.0, 5.0, 6)\nvmyfunc(xa, 1, 1, 1)","key":"hqZ6tv6PPh"},{"type":"output","id":"h5gRGA0h-obLgRZmrWhIu","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"Array([ 1.,  3.,  7., 13., 21., 31.], dtype=float32)","content_type":"text/plain"}}}],"key":"ckrOlC7SpD"}],"key":"rk3dYQtnBF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mais on peut faire des structure bien plus complexes en combinant plusieurs transformations:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V6mO4YFtp3"}],"key":"d9MsZcft2m"}],"key":"IiUNgR8V3Q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"vmyfunc2 = jax.vmap(vmyfunc, in_axes=(None, 0, None, None))\naa = jnp.linspace(0.0, 1.0, 3)\nvmyfunc2(xa, aa, 1, 1)","key":"iJnSMi1JQh"},{"type":"output","id":"6mQf6k50abIMXTg6vYM-y","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"Array([[ 1. ,  2. ,  3. ,  4. ,  5. ,  6. ],\n       [ 1. ,  2.5,  5. ,  8.5, 13. , 18.5],\n       [ 1. ,  3. ,  7. , 13. , 21. , 31. ]], dtype=float32)","content_type":"text/plain"}}}],"key":"jkM2mQeQk0"}],"key":"DXYxuszJTt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Le potentiel est énorme car on peut soit vectoriser en plusieurs strates ou aussi le faire d’un coup en jouant sur les axes selon les besoins.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Frxx9QMMVT"}],"key":"L520kzBQsl"}],"key":"oWKgzFUK2i"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compiler avec ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GO8WRreSAE"},{"type":"inlineCode","value":"jit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K5m4xGiZGn"}],"identifier":"compiler-avec-jit","label":"Compiler avec jit","html_id":"compiler-avec-jit","implicit":true,"key":"YXHcks3BQs"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Il est possible de compiler tout ou partie du code avec ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EjgZpZbAF8"},{"type":"inlineCode","value":"jit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wRoS6d7cFv"},{"type":"text","value":". La compilation va coûter quelques milisecondes et permettre une execution optimisée par la suite.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PHLPhWBM8m"}],"key":"C5ykZAfNrw"}],"key":"KYmSKL0DvL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Ne = 100\nxa = jnp.linspace(0.0, 5.0, 6000)\naa = jnp.linspace(0.0, 1.0, 3000)\nt0 = time.time()\nfor e in range(Ne):\n    val = vmyfunc2(xa, aa, 1, 1)\n    val.block_until_ready()\nt1 = time.time()\ndt0 = (t1 - t0) / Ne\nprint(f\"Exectution took {dt0*1.e3:.2f} ms\")","key":"QRKl9CvrcJ"},{"type":"output","id":"eMuoJiTBj-R8f_wCfcC4b","data":[{"output_type":"stream","name":"stdout","text":"Exectution took 6.99 ms\n"}],"key":"ouRIxZtHYZ"}],"key":"zAxImc1AaT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"jvmyfunc2 = jax.jit(vmyfunc2)\nt0 = time.time()\nval = jvmyfunc2(xa, aa, 1, 1)\nval.block_until_ready()\nt1 = time.time()\ndt1 = t1 - t0\nprint(f\"Compilation + first execution took {dt1*1.e3:.2f} ms\")","key":"ollTzjjSVj"},{"type":"output","id":"kH8RBW-gCcZmePPSDA3w1","data":[{"output_type":"stream","name":"stdout","text":"Compilation + first execution took 19.40 ms\n"}],"key":"EzrY5CV7k0"}],"key":"aAhSzFGn2x"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t0 = time.time()\nfor e in range(Ne):\n    val = jvmyfunc2(xa, aa, 1, 1)\n    val.block_until_ready()\nt1 = time.time()\ndt2 = (t1 - t0) / Ne\nprint(f\"Second execution took {dt2*1.e3:.2f} ms\")","key":"obW5KaOOj3"},{"type":"output","id":"gEW-V2B07QIu0liKpi5ak","data":[{"output_type":"stream","name":"stdout","text":"Second execution took 1.83 ms\n"}],"key":"J4bySE3xHo"}],"key":"qxrwyouxg9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"On a donc gagné du temps avec le jit et ce malgré le fait que notre fonction est très simple et donc très optimisée à la base. Cette tendance sera amplifiée sur des calculs lourds sur GPU/TPU.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ciVYlcvRfZ"}],"key":"QKmNH4QS4l"}],"key":"gp82DFVutR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Autres transformations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Xrr2DXlI5r"}],"identifier":"autres-transformations","label":"Autres transformations","html_id":"autres-transformations","implicit":true,"key":"KrFLWsdJeL"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Les autres transformations ne sont pas cruciales maintenant alors je les passe sous couvert. Mais elles sont ultra intéressantes dans d’autres cas, surtout ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"StC5DRHmns"},{"type":"inlineCode","value":"grad","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"icmOaqja40"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rpVjWsvEyS"}],"key":"tljuKLgXZ2"}],"key":"iIQu3Gtemn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# WIP","key":"WBLTZQQUke"},{"type":"output","id":"0BG31QpPuCNcwaf2UIORJ","data":[],"key":"O0fO1Z9SF7"}],"key":"APF6c3EvIA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Liste non exhaustive des limitations de Jax","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y2rPi643wS"}],"identifier":"liste-non-exhaustive-des-limitations-de-jax","label":"Liste non exhaustive des limitations de Jax","html_id":"liste-non-exhaustive-des-limitations-de-jax","implicit":true,"key":"qEiQvF8VJ8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Forcément, cette belle promesse vient avec pas mal de limitations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sKyICijPEo"}],"key":"f3hgku3QLd"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Les structures de contrôle","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"T3jDTrLkT9"}],"identifier":"les-structures-de-contr-le","label":"Les structures de contrôle","html_id":"les-structures-de-contr-le","implicit":true,"key":"AfZjcKfMCB"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"On commence par une des plus agacentes au début, les structures de contrôle. Fini les ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CY4H6qBqNI"},{"type":"inlineCode","value":"if","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"tPBMWKd4x2"},{"type":"text","value":", ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VaWvAByhvP"},{"type":"inlineCode","value":"for","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"iMA5TnjYud"},{"type":"text","value":"et ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ZSIQEwYJcE"},{"type":"inlineCode","value":"while","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hMnL2NyWnY"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hRP4hgl1GX"}],"key":"lElZvc7oKd"},{"type":"image","url":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.gif","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"MuAeWh2E0v","urlSource":"https://media1.tenor.com/m/-mkYatTHWB0AAAAC/why-whyy.gif","urlOptimized":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.webp"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"En fait, ces dernières ne sont pas claires dans leurs buts et peuvent correspondre à plusieurs objectifs. Jax fournit donc des outils de remplacements qui ne manqueront pas de vous énerver (parfois). A titre d’exemple, ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"T83wLLduqt"},{"type":"inlineCode","value":"for","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"L4KNwlW9Uy"},{"type":"text","value":"sera remplacée alternativement selon les buts par ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Oi4flfCPuA"},{"type":"inlineCode","value":"vmap","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"IzD9VJZJX0"},{"type":"text","value":", ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"sKtmlcVOqq"},{"type":"inlineCode","value":"scan","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"S0I3hwL7Ii"},{"type":"text","value":", ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZftVZlPqKG"},{"type":"inlineCode","value":"where","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"P2mqZ9nWRH"},{"type":"text","value":", ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Hf9IqEGXaB"},{"type":"inlineCode","value":"lax.fori_loop","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"PA8QKGnWfD"},{"type":"text","value":" ou pourra rester ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"tJIXOF2gOv"},{"type":"inlineCode","value":"for","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"lbXyFZKZcE"},{"type":"text","value":" dans ces bien choisis.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"LkLiSCyp9l"}],"key":"xMOYaE92ky"}],"key":"YF4GTmYd58"},{"type":"block","kind":"notebook-content","data":{"lines_to_next_cell":2},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"L’allocation dynamique de mémoire","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MdnuGccD6y"}],"identifier":"lallocation-dynamique-de-m-moire","label":"L’allocation dynamique de mémoire","html_id":"lallocation-dynamique-de-m-moire","implicit":true,"key":"oCZdoU3XVe"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dans le monde de jax, il est interdit d’allouer dynamiquement de la mémoire, par exemple en créant des array de taille inconnue à la compilation. Cela ne manquera pas de vous créer des frustrations. On verra aussi qu’il est possible de trouver des compromis sur ce point. Le chapitre des ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qzgVB77ZuO"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"sharp bits","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y2Y1ykyTN8"}],"key":"UjQrXaUloe"},{"type":"text","value":" et globalement toutes les prises de parole de JakeVPD et Patrick Kidger mérite d’être lues pour comprendre la parole sainte à ce sujet.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QxITrc0rj1"}],"key":"hi1382AcOe"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Exemple:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qqG0LYLxe2"}],"key":"CH8YeMNRL8"}],"key":"nW0OhjOOpr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def dumb_func_allocating_memory(n):\n    a = jnp.arange(n)\n    return a","key":"djQlm85uUj"},{"type":"output","id":"BE9q7dl8QKSc1zsGS4DoN","data":[],"key":"NPZw92Nmbh"}],"key":"vsLrQmvYWV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# jax.make_jaxpr(dumb_func_allocating_memory)(2) # Uncommment to see the error.","key":"xkhzJdLxVe"},{"type":"output","id":"8lOUAgyN0E3AWtuZOs9In","data":[],"key":"vLtMMmKqDG"}],"key":"LmYYB8fQFC"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cHwK6vvmiu"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"ConcretizationTypeError                   Traceback (most recent call last)\nCell In[11], line 1\n----\u003e 1 jax.make_jaxpr(dumb_func_allocating_memory)(2)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YfMzNw1D6B"}],"key":"YNnxARFp1s"},{"type":"code","lang":"","value":"[... skipping hidden 14 frame]","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"T9N6yuDCLA"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Cell In[10], line 2, in dumb_func_allocating_memory(n)\n1 def dumb_func_allocating_memory(n):\n----\u003e 2     a = jnp.arange(n)\n3     return a","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"lY5s7zTIpN"}],"key":"v2t5ug6ou0"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"File ~/miniforge3/envs/science/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:5947, in arange(start, stop, step, dtype, device, out_sharding)\n5945 if sharding is None or not sharding._is_concrete:\n5946   assert sharding is None or isinstance(sharding, NamedSharding)\n-\u003e 5947   return _arange(start, stop=stop, step=step, dtype=dtype,\n5948                  out_sharding=sharding)\n5949 else:\n5950   output = _arange(start, stop=stop, step=step, dtype=dtype)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"NpApbqRinc"}],"key":"L3cx9fxrHO"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"File ~/miniforge3/envs/science/lib/python3.12/site-packages/jax/_src/numpy/lax_numpy.py:5962, in _arange(start, stop, step, dtype, out_sharding)\n5960 util.check_arraylike(“arange”, start)\n5961 if stop is None and step is None:\n-\u003e 5962   start = core.concrete_or_error(None, start, “It arose in the jnp.arange argument ‘stop’”)\n5963 else:\n5964   start = core.concrete_or_error(None, start, “It arose in the jnp.arange argument ‘start’”)","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"OqlYion1H6"}],"key":"ulnnwh5HqD"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"File ~/miniforge3/envs/science/lib/python3.12/site-packages/jax/_src/core.py:1847, in concrete_or_error(force, val, context)\n1845 maybe_concrete = val.to_concrete_value()\n1846 if maybe_concrete is None:\n-\u003e 1847   raise ConcretizationTypeError(val, context)\n1848 else:\n1849   return force(maybe_concrete)","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"tM1rCROAFO"}],"key":"gwNDCAm9bu"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"ConcretizationTypeError: Abstract tracer value encountered where concrete value is expected: traced array with shape int32[]\nIt arose in the jnp.arange argument ‘stop’\nThe error occurred while tracing the function dumb_func_allocating_memory at /var/folders/67/hblp6z8n36ldk_9_bl9g80kh0000gn/T/ipykernel_50677/3347747001.py:1 for jit. This concrete value was not available in Python because it depends on the value of the argument n.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"Ryx3zNuiaB"}],"key":"K6UFzpq24L"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"See ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"by3lnXnovL"},{"type":"link","url":"https://docs.jax.dev/en/latest/errors.html#jax.errors.ConcretizationTypeError","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"https://​docs​.jax​.dev​/en​/latest​/errors​.html​#jax​.errors​.ConcretizationTypeError","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"kIIBWYH3g7"}],"urlSource":"https://docs.jax.dev/en/latest/errors.html#jax.errors.ConcretizationTypeError","key":"cH62pkAlb0"}],"key":"R9XOQj39XN"}],"key":"lo0Dyj31LT"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Frustration, colère ...","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jyhyT9ETxX"}],"key":"zIpObCOYqE"}],"key":"F8brUWEun1"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Dans un tel, cas il faut généralement se demander si on a vraiment besoin que ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HyhrfvLG3l"},{"type":"inlineCode","value":"n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RzCjdvMyxY"},{"type":"text","value":"soit dynamique. Si c’est vraiment le cas, alors on peut le rendre statique (au sens jax) en spécifiant:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JMrR6XEv6y"}],"key":"xt3EKaHIW7"}],"key":"Vu6RBAoJtY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\n\n\ndef make_dumb_function_allocating_memory(n):\n    def dumb_func_allocating_memory2(a):\n        x = a * jnp.arange(n)\n        return x\n\n    return dumb_func_allocating_memory2\n\n\ndfam = jax.jit(make_dumb_function_allocating_memory(3))","key":"XnOo2p2bLC"},{"type":"output","id":"SSA1J3HsAQGepVRgkfLc2","data":[],"key":"ZejSRRCmkI"}],"key":"hB3NahzOwk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"jax.make_jaxpr(dfam)(2)","key":"uZTjCLWWpL"},{"type":"output","id":"5uwi0WoXGzyjm0IhRzQkQ","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"{ \u001b[34;1mlambda \u001b[39;22m; a\u001b[35m:i32[]\u001b[39m. \u001b[34;1mlet\n    \u001b[39;22mb\u001b[35m:i32[3]\u001b[39m = jit[\n      name=dumb_func_allocating_memory2\n      jaxpr={ \u001b[34;1mlambda \u001b[39;22m; a\u001b[35m:i32[]\u001b[39m. \u001b[34;1mlet\n          \u001b[39;22mc\u001b[35m:i32[3]\u001b[39m = iota[dimension=0 dtype=int32 shape=(3,) sharding=None] \n          d\u001b[35m:i32[]\u001b[39m = convert_element_type[new_dtype=int32 weak_type=False] a\n          b\u001b[35m:i32[3]\u001b[39m = mul d c\n        \u001b[34;1min \u001b[39;22m(b,) }\n    ] a\n  \u001b[34;1min \u001b[39;22m(b,) }","content_type":"text/plain"}}}],"key":"Qg5tVLIus6"}],"key":"F9mHfOsvYd"}],"key":"eKhVLO3VCG"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"next":{"title":"Des ODE avec Jax ?","url":"/ode-with-jax","group":"JAX pour Cloé"}}},"domain":"http://localhost:3000"},"project":{"title":"JAX pour Cloé","github":"https://github.com/lcharleux/hello_jax","id":"8d100ed7-36b2-4354-97ab-43bab996214f","thumbnail":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.gif","thumbnailOptimized":"/hello_jax/build/96a8e99706627d5058e08d07f71549be.webp","exports":[],"bibliography":[],"index":"intro-to-jax","pages":[{"slug":"ode-with-jax","title":"Des ODE avec Jax ?","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/hello_jax/build/manifest-51D9907C.js";
import * as route0 from "/hello_jax/build/root-TRTRBUUN.js";
import * as route1 from "/hello_jax/build/routes/$-VLPGWU3Z.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/hello_jax/build/entry.client-PCJPW7TK.js");</script></body></html>