{"version":2,"kind":"Notebook","sha256":"6dc0d40f8ba5259164e3f4e5d671c3978177d4d052b2d6e2d44850388f1fb1d8","slug":"ode-with-jax","location":"/01_ode_with_jax.ipynb","dependencies":[],"frontmatter":{"title":"Des ODE avec Jax ?","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"science","language":"python"},"github":"https://github.com/lcharleux/hello_jax","source_url":"https://github.com/lcharleux/hello_jax/blob/main/book/01_ode_with_jax.ipynb","edit_url":"https://github.com/lcharleux/hello_jax/edit/main/book/01_ode_with_jax.ipynb","exports":[{"format":"ipynb","filename":"01_ode_with_jax.ipynb","url":"/hello_jax/build/01_ode_with_jax-a99c36be6bd959f99482cc1a99bf2261.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib ipympl\nimport numpy as np\nimport jax\nimport jax.numpy as jnp\nimport matplotlib.pyplot as plt\nfrom jax import jit, vmap\nfrom dataclasses import dataclass\nfrom jax.tree_util import register_dataclass\nfrom diffrax import ODETerm, Dopri5, SaveAt, PIDController, diffeqsolve","key":"XoB6IOxdmj"},{"type":"output","id":"GcG1NYy_4oHiC27uEoP2f","data":[],"key":"vGrETBvefF"}],"key":"sT0JqaFo4N"},{"type":"block","kind":"notebook-content","data":{"vscode":{"languageId":"mo-python"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Problème","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aFN5tlboGA"}],"identifier":"probl-me","label":"Problème","html_id":"probl-me","implicit":true,"key":"KfvjIBbuO8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"On s’intéresse à une paire d’oscillateurs linéaires couplés par une raideur ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WS94gyen2D"},{"type":"inlineMath","value":"K_{12}","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>K</mi><mn>12</mn></msub></mrow><annotation encoding=\"application/x-tex\">K_{12}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"ZhaH7DDHIK"},{"type":"text","value":".\nOn voudrait trouver un régime permanent de manière simple, par exemple en simulant quelques périodes d’excitation.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wdueYJJSGy"}],"key":"APiGiwg9Cc"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"L’équation différentielle est:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"pasQ8YVGXU"}],"key":"BCXICeCrQ1"},{"type":"math","value":"\\left \\lbrace \n\\begin{split}\nM_1  \\ddot x_1 + D_1  \\dot x_1 + K_1  x_1 + K_{12} (x_1 - x_2) = F_{d1} \\sin (w_d t)  \\\\\nM_2  \\ddot x_2 + D_2  \\dot x_2 + K_2  x_1 + K_{12} (x_2 - x_1) = F_{d2} \\sin (w_d t) \n\\end{split}\n\\right .","position":{"start":{"line":8,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.25em\" columnalign=\"right\" columnspacing=\"\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><msub><mi>M</mi><mn>1</mn></msub><msub><mover accent=\"true\"><mi>x</mi><mo>¨</mo></mover><mn>1</mn></msub><mo>+</mo><msub><mi>D</mi><mn>1</mn></msub><msub><mover accent=\"true\"><mi>x</mi><mo>˙</mo></mover><mn>1</mn></msub><mo>+</mo><msub><mi>K</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>K</mi><mn>12</mn></msub><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>F</mi><mrow><mi>d</mi><mn>1</mn></mrow></msub><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><msub><mi>w</mi><mi>d</mi></msub><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><msub><mi>M</mi><mn>2</mn></msub><msub><mover accent=\"true\"><mi>x</mi><mo>¨</mo></mover><mn>2</mn></msub><mo>+</mo><msub><mi>D</mi><mn>2</mn></msub><msub><mover accent=\"true\"><mi>x</mi><mo>˙</mo></mover><mn>2</mn></msub><mo>+</mo><msub><mi>K</mi><mn>2</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>K</mi><mn>12</mn></msub><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>F</mi><mrow><mi>d</mi><mn>2</mn></mrow></msub><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><msub><mi>w</mi><mi>d</mi></msub><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding=\"application/x-tex\">\\left \\lbrace \n\\begin{split}\nM_1  \\ddot x_1 + D_1  \\dot x_1 + K_1  x_1 + K_{12} (x_1 - x_2) = F_{d1} \\sin (w_d t)  \\\\\nM_2  \\ddot x_2 + D_2  \\dot x_2 + K_2  x_1 + K_{12} (x_2 - x_1) = F_{d2} \\sin (w_d t) \n\\end{split}\n\\right .</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3em;vertical-align:-1.25em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">{</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.75em;\"><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2222em;\"><span class=\"mord\">¨</span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1111em;\"><span class=\"mord\">˙</span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2222em;\"><span class=\"mord\">¨</span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1111em;\"><span class=\"mord\">˙</span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.25em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"1","key":"b4Hch4vmhl"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Et d’un point de vue physique, on voudrait connaitre les énergies dissipées par les amortissements ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Akq6HkZh9s"},{"type":"inlineMath","value":"D_1","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>D</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">D_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"YVyZSkhirM"},{"type":"text","value":" et ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"dyLy1pNpo9"},{"type":"inlineMath","value":"D_2","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>D</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">D_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"tfTdoep2yo"},{"type":"text","value":" en régime permanent.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"VH6SJKFdxb"}],"key":"YIhRU6oPCW"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"vB1QwneV7X"}],"key":"GfwxfgCAP6"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Il est possible de simplifier grandement cette équation en l’adimensionnant mais on fait le choix de ne pas le faire ici.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"WBCJHiXWuE"}],"key":"Y2n6GTOTlC"}],"key":"fKl2BDKCQV"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"On la traduit comme suit en Python:","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"Pf32Oul3tb"}],"key":"iKrbzsoqqx"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":26,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"On crée une classe pour stocker les paramètres du problème. C’est une solution assez pratique pour éviter de passer trop d’arguments à l’ODE et on peut gérer ça de manière transparente avec Jax.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"DrfQghXP9r"}],"key":"f0r3SJWTBO"}],"key":"HhLq37DgYx"}],"key":"ySA9San5f2"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"YamyjmO5E0"}],"key":"NVIF7kkvPU"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Les paramètres par défaut sont pris au pif, c’est une mauvaise idée. Si vous avez mieux, dites le moi !","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"ZcBVBUHFfW"}],"key":"KLGzDXa1Jy"}],"key":"DZeM8HnnRG"}],"key":"cn2F6lV8Ki"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"@register_dataclass\n@dataclass\nclass CoupleLinearResonatorParams:\n    \"\"\"\n    Parameters for the coupled linear resonator ODE system.\n    \"\"\"\n\n    M1: float = 1.0  # Mass 1\n    M2: float = 1.0  # Mass 2\n    K1: float = 1.0  # Spring constant 1\n    K2: float = 1.0  # Spring constant 2\n    K12: float = 0.5  # Coupling spring constant 2\n    D1: float = 0.01  # Damping coefficient 1\n    D2: float = 0.01  # Damping coefficient 2\n    wd: float = 0.5  # Driving frequency\n    Fd1: float = 0.5  # Driving force amplitude 1\n    Fd2: float = 0.5  # Driving force amplitude 2\n\n\node_params = CoupleLinearResonatorParams(Fd2=0.0)\node_params","key":"YXoiZev36z"},{"type":"output","id":"z9FQECFtF3Im-_Dz6eYFv","data":[{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"CoupleLinearResonatorParams(M1=1.0, M2=1.0, K1=1.0, K2=1.0, K12=0.5, D1=0.01, D2=0.01, wd=0.5, Fd1=0.5, Fd2=0.0)","content_type":"text/plain"}}}],"key":"aZ1igc8FF2"}],"key":"fl5Xe4afLr"},{"type":"block","kind":"notebook-content","children":[{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"On écrit l’ODE:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MDcap3biyS"}],"key":"Wrcq3Jdcf8"}],"key":"xiY1PZWRJ0"}],"key":"ZFrxvptP2a"}],"key":"QftHKNpjsr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def coupled_linear_resonator_ode(t, X, params: CoupleLinearResonatorParams):\n    x1, v1, x2, v2, E1, E2 = X\n    dx1dt = v1\n    dv1dt = (\n        -params.K1 * x1\n        - params.K12 * (x1 - x2)\n        - params.D1 * v1\n        + params.Fd1 * jnp.sin(params.wd * t)\n    ) / params.M1\n    dx2dt = v2\n    dv2dt = (\n        -params.K2 * x2\n        - params.K12 * (x2 - x1)\n        - params.D2 * v2\n        + params.Fd2 * jnp.sin(params.wd * t)\n    ) / params.M2\n    P1 = v1**2 * params.D1\n    P2 = v2**2 * params.D2\n    return jnp.array([dx1dt, dv1dt, dx2dt, dv2dt, P1, P2])\n\n\nX0 = jnp.array(\n    [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]\n)  # Initial state: [x1, v1, x2, v2, E1, E2]\nt = 0.2  # Initial time\ncoupled_linear_resonator_ode(t, X0, ode_params)","key":"Uy9ooE8JLp"},{"type":"output","id":"RvEtABVC-IuxjFDSRUlDo","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"Array([0.        , 0.04991671, 0.        , 0.        , 0.        ,\n       0.        ], dtype=float32)","content_type":"text/plain"}}}],"key":"YHcebW6sHj"}],"key":"RyrsCtQ0Zn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Ok, notre ODE fonctionne.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mPJs07fVfy"}],"key":"PwZkHjBVjn"},{"type":"list","ordered":true,"start":3,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Essayons de l’intégrer:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PWERW2WkON"}],"key":"AV63AnNaEG"}],"key":"VnVCkR3hsi"}],"key":"DoOPxavTOg"}],"key":"DbGQCXXpBn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"term = ODETerm(coupled_linear_resonator_ode)  # Define the ODE term\nsolver = Dopri5()  # Choose the Dormand-Prince 5(4) solver\nt0 = 0.0  # Initial time\nt1 = 10.0  # Final time\n\nsaveat = SaveAt(ts=[t0, t1])  # Specify time points to save the solution\nstepsize_controller = PIDController(rtol=1e-5, atol=1e-5)\nsol = diffeqsolve(\n    term,\n    solver,\n    t0=t0,\n    t1=t1,\n    dt0=0.1,\n    y0=X0,\n    saveat=saveat,\n    stepsize_controller=stepsize_controller,\n    args=ode_params,\n)\n\nprint(sol.ts)  # DeviceArray([0.   , 1.   , 2.   , 3.    ])\nprint(sol.ys)  # DeviceArray([1.   , 0.368, 0.135, 0.0498])","key":"d3mm5Pf51L"},{"type":"output","id":"vC1RSgClZqlLSDMweYPMK","data":[{"output_type":"stream","name":"stdout","text":"[ 0. 10.]\n[[ 0.          0.          0.          0.          0.          0.        ]\n [-0.42091748  0.20012264 -0.05067536  0.15972877  0.00453042  0.00254664]]\n"}],"key":"sOxWBFk5C6"}],"key":"V925wgQbYn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Ok cela fonctionne, on peut donc construire une fonction qui fait la tâche demandée:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"beuQteGCTd"}],"key":"t4Mu1OFx6H"}],"key":"RdyrR3SNmh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"@register_dataclass\n@dataclass\nclass CalculateSteadyStatePowerParams:\n    t0: float = 0.0\n    t1: float = 5.0\n\n\ndef calculate_steady_state_power(\n    X0,\n    ode_params: CoupleLinearResonatorParams,\n    calc_params: CalculateSteadyStatePowerParams,\n):\n    \"\"\"\n    Calculate the steady-state power dissipated by each resonator.\n\n        A tuple containing the steady-state power dissipated by resonator 1 and resonator\n    \"\"\"\n    term = ODETerm(coupled_linear_resonator_ode)  # Define the ODE term\n    solver = Dopri5()  # Choose the Dormand-Prince 5(4) solver\n    t0 = calc_params.t0  # Initial time\n    t1 = calc_params.t1  # Final time\n    Td = 2 * jnp.pi / ode_params.wd  # Driving period\n    t2 = t1 + Td\n\n    saveat0 = SaveAt(ts=[t0, t1])  # Specify time points to save the solution\n    stepsize_controller = PIDController(rtol=1e-5, atol=1e-5)\n    sol0 = diffeqsolve(\n        term,\n        solver,\n        t0=t0,\n        t1=t1,\n        dt0=0.1,\n        y0=X0,\n        saveat=saveat0,\n        stepsize_controller=stepsize_controller,\n        args=ode_params,\n    )\n    X1 = sol0.ys[-1]  # State at time t1\n    X1 = X1.at[4:].set(0.0)  # Reset accumulated power to zero\n    saveat1 = SaveAt(ts=[t1, t2])  # Specify time points to save the solution\n    sol1 = diffeqsolve(\n        term,\n        solver,\n        t0=t1,\n        t1=t2,\n        dt0=0.1,\n        y0=X1,\n        saveat=saveat1,\n        stepsize_controller=stepsize_controller,\n        args=ode_params,\n    )\n    X2 = sol1.ys[-1]  # State at time t2\n    P = (X2[4:]) / Td  # Average power dissipated over one period\n    return P\n\n\nP = calculate_steady_state_power(\n    X0, ode_params, CalculateSteadyStatePowerParams(t0=0.0, t1=5.0)\n)\nP","key":"ufd3h9dgjS"},{"type":"output","id":"Imh7EV1HXsyQynh5VSYvx","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"Array([0.00041234, 0.00020403], dtype=float32)","content_type":"text/plain"}}}],"key":"zLWvTAzN3w"}],"key":"Ofl95ACIvc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"On peut donc calculer les puissances en régime établi pour les 2 oscillateurs.\nFaisons maintenant une étude paramétrique avec ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iD0jEJeGKh"},{"type":"inlineCode","value":"vmap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M1mKBBfnnR"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mXbJDe4o6S"}],"key":"uhFoy3BzSj"}],"key":"etzGgXEUBV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"K1v = jnp.linspace(0.1, 1.0, 100)\nK2v = jnp.linspace(0.05, 0.1, 100)\n\nvcalc_steady_state_power = vmap(\n    vmap(\n        calculate_steady_state_power,\n        in_axes=(\n            None,\n            CoupleLinearResonatorParams(\n                M1=None,\n                M2=None,\n                K1=0,\n                K2=None,\n                K12=None,\n                D1=None,\n                D2=None,\n                wd=None,\n                Fd1=None,\n                Fd2=None,\n            ),\n            None,\n        ),\n    ),\n    in_axes=(\n        None,\n        CoupleLinearResonatorParams(\n            M1=None,\n            M2=None,\n            K1=None,\n            K2=0,\n            K12=None,\n            D1=None,\n            D2=None,\n            wd=None,\n            Fd1=None,\n            Fd2=None,\n        ),\n        None,\n    ),\n)\node_params2 = CoupleLinearResonatorParams(Fd2=0.0, K1=K1v, K2=K2v)\nP2 = vcalc_steady_state_power(\n    X0, ode_params2, CalculateSteadyStatePowerParams(t0=0.0, t1=5.0)\n)\nP2.shape","key":"BSjyeuns21"},{"type":"output","id":"vP_ssB6Ma8x0E8deS9dgy","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"(100, 100, 2)","content_type":"text/plain"}}}],"key":"Dv4koOEV9w"}],"key":"EJAOqSPAt8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(10, 5))\nax0 = fig.add_subplot(121)\nplt.contourf(K1v, K2v, P2[:, :, 0].T * 1.0e3, levels=20, cmap=\"jet\")\nplt.colorbar(\n    label=\"Steady-State Power Dissipated by Resonator 1 [mW]\", orientation=\"horizontal\"\n)\nplt.contour(K1v, K2v, P2[:, :, 0].T * 1.0e3, levels=20, colors=\"black\", linewidths=0.5)\nplt.xlabel(\"K1\")\nplt.ylabel(\"K2\")\nplt.grid()\nax1 = fig.add_subplot(122)\nplt.contourf(K1v, K2v, P2[:, :, 1].T * 1.0e3, levels=20, cmap=\"jet\")\nplt.colorbar(\n    label=\"Steady-State Power Dissipated by Resonator 2 [mW]\", orientation=\"horizontal\"\n)\nplt.contour(K1v, K2v, P2[:, :, 1].T * 1.0e3, levels=20, colors=\"black\", linewidths=0.5)\nplt.xlabel(\"K1\")\n# plt.ylabel(\"K2\")\nplt.grid()\nplt.show()","key":"uLUT7sQUkE"},{"type":"output","id":"VlGUq0tUn9maMreEzf--B","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"522f2c831f0fac792dc0bbc7f77c7ae5","path":"/hello_jax/build/522f2c831f0fac792dc0bbc7f77c7ae5.png"},"text/html":{"content_type":"text/html","hash":"69ca1b35961351c85b5b4b56d0f203b8","path":"/hello_jax/build/69ca1b35961351c85b5b4b56d0f203b8.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"844a53d3d5744d1c9b9d540816cb0349\"}","content_type":"application/vnd.jupyter.widget-view+json"}}}],"key":"fozDTBASt5"}],"key":"JWy2i5ZB11"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"C’est beau mais assez étrange. A discuter !","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"F8uwqjqKFU"}],"key":"AX3eFrT2rU"}],"key":"QNunFe423g"}],"key":"lsZeWhlBzY"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"JAX pour Cloé","url":"/","group":"JAX pour Cloé"}}},"domain":"http://localhost:3004"}